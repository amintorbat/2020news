## راهنمای Frontend – ۲۰۲۰نیوز

### هدف پروژه
۲۰۲۰نیوز داده‌های رسمی فدراسیون (ACS) را برای فوتسال و فوتبال ساحلی بدون هیچ ابزار تحریریه‌ای در UI نمایش می‌دهد. مأموریت ما ارائه‌ی خبرهای اصلی، جدول لیگ و برنامه مسابقات با fallback مطمئن است تا وابسته به خروجی‌های محلی یا موقت نباشیم.

### ساختار پوشه‌ها
- `app/` مسیرهای App Router و route handlerها را دارد. صفحه اصلی ACS را مدیریت می‌کند، `/news` و `/news/[slug]` فید خبر، `/futsal` و `/beach` صفحات ورزشی، و `/api/acs/*` اسکرپرها را در بر می‌گیرد.
- `components/` بلوک‌های قابل استفاده مجدد است؛ `home/` ویجت‌های صفحه اصلی، `layout/` اسکلت سراسری، و فولدرهای `matches/`, `news/`, `tables/`, `live/` برای بخش‌های تخصصی هستند.
- `lib/acs/` شامل کلاینت‌ها و fallbackهای ACS است؛ `lib/data.ts` داده‌های قطعی برای رندر آفلاین و `lib/acs/types.ts` مدل‌های تایپ‌شده را نگه می‌دارند.
- `data/` فایل‌های ناوبری و کپی‌های ساختاریافته را ذخیره می‌کند تا بدون دست‌زدن به کامپوننت‌ها قابل تغییر باشند.
- `assets/` و `public/` فقط برای آیکون‌ها و تصاویر استاتیک هستند.
- `docs/` همین راهنما (انگلیسی/فارسی) را نگه می‌دارد تا آنبوردینگ هماهنگ بماند.

### لایه ACS
- تمام Fetch‌ها در سمت سرور و از طریق `fetchWithRetry` انجام می‌شوند که دارای timeout، retry و header‌های سفارشی است.
- داده‌ها به مدل‌های تایپ‌شده (`Article`, `Match`, `StandingsRow`) نگاشت می‌شوند؛ مقادیر مهمی مانند `slug`، `sport` و `imageUrl` همیشه مقداردهی می‌شوند تا UI دچار خطا نشود.
- برای هر منبع (`home.ts`, `matches.ts`, `standings.ts`, `articleDetail.ts`) یک fallback تعریف شده (`fallback.ts`) تا هنگام قطعی مبدأ، خروجی معنی‌دار باقی بماند.
- لاگ‌ها با `logWarnOnce` کنترل می‌شوند تا هر خطا فقط یک‌بار هشدار دهد و کنسول از پیام‌های تکراری خالی بماند.

### انتخاب تصویر شاخص (خبر)
- تصویر شاخص فقط از داخل بدنه اصلی خبر انتخاب می‌شود تا بنرها/سایدبارها وارد نشوند.
- هر تصویر داخل کانتینرهای تبلیغات/بنر/اعتماد/نشان حذف می‌شود و دامنه `trustseal.e-rasaneh.ir` همیشه بلاک است.
- فایل‌های شبیه آیکون/لوگو/نشان رد می‌شوند؛ اگر مورد مناسبی پیدا نشود، مقدار `featuredImage` برابر `null` خواهد بود.
- برای دیباگ سریع: `node docs/acs-featured-image-smoke.mjs <fullcontent-url>` را اجرا کنید تا عنوان، میزبان تصویر و وضعیت رد شدن چاپ شود.

### مسئولیت اجزا
- **HeroSlider**: حداکثر ۶ خبر را با تصویر سمت راست و متن سمت چپ نمایش می‌دهد و همیشه از تصویر جایگزین استفاده می‌کند.
- **NewsList / NewsCard**: در صفحه اصلی فقط ۶ خبر مهم با چینش تصویربالا-متن پایینی نشان داده می‌شود و مسیر کلیک همیشه داخلی (`/news/[slug]`) است.
- **MatchesTabs**: برنامه بازی‌ها را بر اساس لیگ و وضعیت (امروز/هفته جاری) تفکیک کرده و برچسب‌های وضعیت را با رنگ‌بندی مشخص نشان می‌دهد.
- **LeagueTablesPreview**: فقط یک کارت فشرده نشان می‌دهد و با تب به لیگ‌های دیگر تغییر می‌کند؛ در صورت نبود داده پیام خالی نمایش داده می‌شود.
- **News pages**: `app/news/page.tsx` اخبار باقی‌مانده را بر اساس رشته دسته‌بندی می‌کند و `app/news/[slug]/page.tsx` بدنه کامل خبر را از ACS می‌کشد.

### فلسفه مدیریت خطا
- هر Fetch در try/catch پیچیده شده و در صورت شکست، یک‌بار هشدار داده می‌شود و سپس به داده‌های محلی برمی‌گردد.
- تمام لینک‌ها به صفحات داخلی هدایت می‌شوند؛ حتی وقتی منبع اصلی ۲۰۲۰نیوز در دسترس نباشد، صفحه با متن جایگزین و تصویر ثابت بارگذاری می‌شود.
- هر کامپوننت قبل از رندر شرایط خالی (مانند آرایه بدون عضو) را بررسی می‌کند تا هیچ Box سفید بدون محتوا ایجاد نشود.

### توسعه آتی
- برای پوشش خبرهای بیشتر، می‌توان ماژول دیگری در `lib/acs/` برای آرشیو (مثلاً `/Archive`) اضافه کرد و نتیجه آن را در صفحه خبر استفاده کرد.
- می‌توان لایه کش (Redis/Vercel KV) را در کنار کش درون‌حافظه‌ای فعلی اضافه کرد تا پاسخ‌ها میان چندین منطقه سرور هم به اشتراک گذاشته شوند.
- برای بهبود سئو، پیشنهاد می‌شود متادیتای دینامیک (OG و Structured Data) بر اساس Article Detail تزریق شود.

### اجرای محلی
1. `npm install` – وابستگی‌های Next.js و ماژول‌های ACS را نصب می‌کند؛ نیازی به ابزار سراسری نیست.
2. `npm run lint` – همان Rule-set تولیدی را اجرا می‌کند و باید قبل از merge کاملاً تمیز باشد.
3. `npm run build` – ساختار App Router و fallbackها را تأیید می‌کند؛ در CI نیز همین گام اجرا می‌شود.
4. `npm run dev` – سرور توسعه را روی پورت ۳۰۰۰ برای QA دستی بالا می‌آورد.

### محدودیت‌های فعلی
- اندپوینت‌های ACS (`2020news.ir`) در محیط محلی غیرفعال‌اند و اسکرپرها به JSONهای fallback تکیه می‌کنند.
- ویجت‌های پخش زنده و برنامه مسابقات تا زمان آماده‌شدن منبع رسمی از داده‌های موک استفاده می‌کنند.
- هنوز CMS متصل نیست؛ به‌روزرسانی ناوبری یا ترتیب اسلایدها نیازمند ویرایش فایل‌های `data/` یا `lib/data.ts` است.
- کش Redis/KV پیاده نشده و هر درخواست تولیدی داده‌های ACS را مجدداً تولید می‌کند.
